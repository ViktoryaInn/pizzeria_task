<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <title>Index</title>
    <script type="text/javascript" th:inline="javascript"></script>
    <script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
</head>
<header>
    <h2>Index</h2>
</header>
<body>
<div>
    <div th:id="${ingredient.getId()}" th:each="ingredient: ${ingredients}">
        <div class="ingredient">
            <form action="/" method="get">
                <p th:text="'id:' + ${ingredient.getId()}" style="display: none;"/>
                <p  th:text="'Ingredient name: ' + ${ingredient.getName()}"></p>
                <p  th:text="'ingredient price: ' + ${ingredient.getPrice()}"></p>
                <button  class="btn btn-sm choose-btn" th:id="${ingredient.getId()}" th:attr="data-ingredient-id=${ingredient.getId()}, data-ingredient-cost=${ingredient.getPrice()}">CLick</button>
            </form>
        </div>
    </div>
    <form action="/add" method="post" name="orderForm">
        <input type="text" name="name" id="name" th:required="required"/>
        <input type="text" name="phone" id="phone" th:required="required">
        <button type="submit" id="submit" class="btn btn-sm subbb-btn">Submit</button>
    </form>
    <div class="total-cost"></div>
    <button class="btn btn-sm send-btn">Send</button>
</div>

<script>
    // let menu = document.querySelector('.header__menu');
    // addEventListener(".choose-btn")
    let ingredients = [];
    let totalCost = 0;

    $(".total-cost").innerHTML=""
    let totalCostEl = document.createElement("p");
    totalCostEl.innerText = `Total Cost: ${totalCost}`;
    totalCostEl.classList.add("total-cost__label");
    $(".total-cost").append(totalCostEl);

    $(".total-cost__label").change((e) => {
        console.log(e)
    })

    $(".choose-btn").click((e) => {
        e.preventDefault();
        let btn = $(e.currentTarget);
        let ingredientId = btn.attr("data-ingredient-id");
        ingredients.push(ingredientId);
        let ingredientCost = btn.attr("data-ingredient-cost");
        totalCost = totalCost + Number.parseInt(ingredientCost)
        totalCostEl.innerText = `Total Cost: ${totalCost}`;
        console.log(ingredients, totalCost);
        // $.post("/task/" + taskId + "/delete", () => {
        // });
        // document.location.href = "/board";
    });

    $(".send-btn").click((e) => {
        // console.log(ingredients);
        let form = document.forms.orderForm;
        console.log(form.elements.name.value, form.elements.phone.value, ingredients);
        const ingredientsString = ingredients.join(' ');
        $.post("/add", {
            name: form.elements.name.value,
            phone: form.elements.phone.value,
            ingredients: ingredientsString
        });
    });

    // $(".subbb-btn").click((e) => {
    //     e.preventDefault();
    //     console.log(e);
    // });
</script>
</body>
</html>

<!--<!DOCTYPE html>-->
<!--<html lang="en" xmlns:th="http://www.thymeleaf.org">-->
<!--<head>-->
<!--    <meta charset="UTF-8">-->
<!--    <title>Add Order</title>-->
<!--&lt;!&ndash;    <script type="text/javascript" th:inline="javascript">&ndash;&gt;-->
<!--&lt;!&ndash;        const ingredients = [[${ingredients}]];&ndash;&gt;-->
<!--&lt;!&ndash;    </script>&ndash;&gt;-->
<!--</head>-->
<!--<header>-->
<!--  <h2>Add Order</h2>-->
<!--</header>-->
<!--<body>-->
<!--    <div class="content">-->
<!--        <div  th:id="${ingredient.getId()} + ingredient" th:each="ingredient : ${ingredients}">-->
<!--            <div class="task">-->
<!--                <form action="/add" method="get">-->
<!--                    <p th:text="'id:' + ${ingredient.getId()}" style="display: none;"/>-->
<!--                    <p  th:text="'Ingredient name: ' + ${ingredient.getName()}"></p>-->
<!--                    <p  th:text="'ingredient price: ' + ${ingredient.getPrice()}"></p>-->
<!--                    <button  class="btn btn-sm delete-btn" th:id="${ingredient.getId()}" th:attr="data-task-id=${ingredient.getId()}">CLick</button>-->
<!--                </form>-->
<!--            </div>-->
<!--        </div>-->
<!--    </div>-->
<!--</body>-->
<!--</html>-->